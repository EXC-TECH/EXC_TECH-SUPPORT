"use strict";var _createClass=function(){function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(f,s,v,m,k){var t=(_createClass(e,[{key:"eventHandlers",value:function(){var i=this;v(".body_wrapper").on("click","#option1, #option2",function(t){if(0===v(".admin_bar").length){v(this).css("pointer-events","none");var e=v(this).attr("href");return i.storePath(this),1===v("#article_toc ol li").length&&f.history.replaceState({path:f.location.pathname},"",f.location.pathname),v.ajax({type:"GET",url:e+"?ajax=true",contentType:"application/json",dataType:"json",success:function(t){v("html, body").animate({scrollTop:0},400),i.loadNextStep(t)}}),!1}}),0<v("#article_options").length&&0===v(".admin_bar").length&&f.addEventListener("popstate",function(t){t.state&&t.state.path&&location.reload(!0)}),v("article.search_bar button").on("click",function(){var t=v(this).siblings("input").val();i.search(t)}),v("article.search_bar input").keypress(function(t){var e=v(this).val();13==(t.keyCode?t.keyCode:t.which)&&i.search(e)}),v("section.search button").on("click",function(){var t=v(this).siblings("input").val();i.search(t)}),v("section.search input").keypress(function(t){var e=v(this).val();13==(t.keyCode?t.keyCode:t.which)&&i.search(e)}),v("#search_filter").on("click","input",function(){var t=v("#search_filter input:checked"),e=v("#search_results");e.find("li").hide(),t.length?t.each(function(){e.find('li[data-product="'+v(this).val()+'"]').show()}):e.find("li").show()}),v(".body_wrapper").on("click","#previous_step",function(){var t=v("#article_toc li:nth-child(2) a").attr("href");f.location=t})}},{key:"search",value:function(t){var e=f.location.protocol+"//"+f.location.host+"/search?q="+t;f.location.href=e}},{key:"loadNextStep",value:function(t){var e=f.location.pathname.split("/"),i=v("#article_body"),o=v("#article_toc ol"),a=v("#article_options"),n=t.sectionArticle.Article.text,s=t.sectionArticle.Article.title,l=t.sectionArticle.option1Text,r=t.sectionArticle.option1Id,c=t.sectionArticle.option2Text,p=t.sectionArticle.option2Id,h="",u=m.template('<a id="option<%= optionNum %>" data-id="<%= optionId %>" href="<%= optionId %>" class="option_bttn"><%= optionText %></a>');e[5]=t.sectionArticle.id,e=e.join("/"),f.history.pushState({path:e},"",e),!r||0<r&&(h+=u({optionNum:1,optionId:r,optionText:l})),p&&0<p&&(h+=u({optionNum:1,optionId:p,optionText:c})),0===r&&0===p&&(h='<a id="support_option" href="//'+k.hostnames.mbcom+'/support/select" class="option_bttn">Open Support Case</a>'),h+='<button id="previous_step" class="previous_step">&lt; Previous Step</button>',i.fadeOut(300,"swing",function(){v(this).html(n)}).fadeIn(300),a.fadeOut(300,"swing",function(){v(this).html(h)}).fadeIn(300),o.find("li.active").removeClass("active"),o.find("li.new").removeClass("new");var d=m.template('<li id="article_title" class="active new">\n            <a href="<%= newUrl %>">\n              <%= newTitle %>\n            </a>\n          </li>');o.prepend(d({newTitle:s,newUrl:e}))}},{key:"buildLearnTOC",value:function(){var t=v("#article_toc ol"),e=v("#article_body").find("h2"),i=this;t.html(""),e.each(function(){t.append("<li data-slug="+i.slugify(v(this).text())+">"+v(this).text()+"</li>")}),t.find("li").first().addClass("active")}},{key:"initLearnTOC",value:function(){var r={},t=v("#article_toc ol"),c=t.find("li");if(v("#article_body").find("h2").each(function(t){var e=v(this).offset().top-120;r[e]=t,v(c[t]).data("scroll",e)}),f.location.hash){var e=f.location.hash.substring(1),i=t.find('li[data-slug="'+e+'"]');i.length&&v("html, body").animate({scrollTop:v(i).data("scroll")},300)}v(s).on("scroll",m.debounce(function(){var i=v("#article_toc"),t=v("#article_toc_spacer"),e=(v("section.article"),v("#article_body")),o=v(f).scrollTop(),a=i.offset().top,n=i.height(),s=e.height(),l=a+n-(e.offset().top+s)+50;i.hasClass("bottom")?o+100<a&&(i.removeClass("bottom"),i.addClass("stuck"),t.css("display","inline-block"),i.css("margin-top","")):i.hasClass("stuck")?0<=l?(i.removeClass("stuck"),i.addClass("bottom"),t.hide(),i.css("margin-top",s-n+25)):o<330&&(i.removeClass("stuck"),t.hide()):330<o&&(i.addClass("stuck"),t.css("display","inline-block")),m.forEach(r,function(t,e){e<=o&&(i.find("li").removeClass("active"),v(c[t]).addClass("active"))})},10)),t.on("click","li",function(){v("html, body").animate({scrollTop:v(this).data("scroll")},300),f.location.replace("#"+v(this).data("slug"))})}},{key:"storePath",value:function(t){var e="supportPath",i=JSON.parse(this.readCookie(e))||{},o=v("#article_body").text(),a=v(t).text(),n=f.location.pathname.split("/"),s=n[5]||"",l=n[4].match(/_([0-9]{5,})/)[1],r="https://"+k.hostnames.support+"/troubleshooting/"+l;o=(o=o.replace(/(\r\n|\n|\r|\t)/gm,"")).split(".").slice(-2).join("."),0<s&&n.pop(),i.url==r&&""!==s||(i.url=r,i.answers={}),i.answers[r+"/"+s]={text:o,answer:a},this.createCookie(e,JSON.stringify(i),1)}},{key:"createCookie",value:function(t,e,i){var o="";if(i){var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3),o="; expires="+a.toGMTString()}var n=f.location.hostname.split(".");n="."+(n=m.takeRight(n,2).join(".")),s.cookie=t+"="+e+o+"; path=/;domain="+n}},{key:"readCookie",value:function(t){for(var e=t+"=",i=s.cookie.split(";"),o=0;o<i.length;o++){for(var a=i[o];" "==a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null}},{key:"slugify",value:function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}}]),e);function e(){_classCallCheck(this,e),this.eventHandlers()}k.Support=t}(window,document,jQuery,_,MakerBot);